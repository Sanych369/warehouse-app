<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление товарами и категориями</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<main>
    <div class="management">
        <div class="management-title">
            <h2>Управление товарами и категориями</h2>
            <p>Здесь вы можете управлять товарами и категориями системы.</p>
        </div>

        <div class="management-actions">
            <div class="button-container">
                <button class="dashboard-item" onclick="toggleGoodsTableVisibility()">Получить список товаров</button>
            </div>
        </div>

        <!-- Таблица товаров -->
        <div class="goods-table-container" id="goodsTableContainer" style="display:none;">
            <table id="goodsTable">
                <thead>
                <tr>
                    <th>Название товара</th>
                    <th>Категория</th>
                    <th>Цена</th>
                    <th>Количество</th>
                    <th>Действия</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>

            <!-- Пагинация для товаров -->
            <div class="pagination" id="goodsPagination">
                <button onclick="prevGoodsPage()">Назад</button>
                <span id="goodsPageInfo">Страница 1</span>
                <button onclick="nextGoodsPage()">Вперед</button>
            </div>

            <!-- Кнопки выбора количества товаров на странице -->
            <div class="page-size-selector">
                <button onclick="setGoodsPerPage(10)">10</button>
                <button onclick="setGoodsPerPage(30)">30</button>
                <button onclick="setGoodsPerPage(90)">90</button>
            </div>

            <button class="hide-table-btn" onclick="toggleGoodsTableVisibility()">Скрыть таблицу</button>
        </div>
    </div>
</main>

<script>
    let currentGoodsPage = 0;
    let goodsPerPage = 10;
    let totalPages = 1;

    function loadGoods() {
        const url = `/goods/list?page=${currentGoodsPage}&size=${goodsPerPage}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.querySelector('#goodsTable tbody');
                tableBody.innerHTML = '';

                data.content.forEach(good => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td>${good.name}</td>
                    <td>${good.category}</td>
                    <td>${good.price}</td>
                    <td>${good.balance}</td>
                    <td>
                        <a href="#" onclick="editGood(${good.id})">Редактировать</a> |
                        <a href="#" onclick="deleteGood(${good.id})">Удалить</a>
                    </td>
                `;
                    tableBody.appendChild(row);
                });

                // Обновляем информацию о пагинации
                document.getElementById('goodsPageInfo').textContent = `Страница ${currentGoodsPage + 1} из ${data.totalPages}`;
                totalPages = data.totalPages; // Устанавливаем общее количество страниц
                document.getElementById('goodsTableContainer').style.display = 'block';
            })
            .catch(error => console.error('Ошибка при получении списка товаров:', error));
    }

    function prevGoodsPage() {
        if (currentGoodsPage > 0) {
            currentGoodsPage--;
            loadGoods();
        }
    }

    function nextGoodsPage() {
        if (currentGoodsPage < totalPages - 1) {
            currentGoodsPage++;
            loadGoods();
        }
    }

    function toggleGoodsTableVisibility() {
        const tableContainer = document.getElementById('goodsTableContainer');
        tableContainer.style.display = tableContainer.style.display === 'none' ? 'block' : 'none';
    }

    // Функция для изменения количества товаров на странице
    function setGoodsPerPage(size) {
        goodsPerPage = size;
        currentGoodsPage = 0; // Сбрасываем на первую страницу при изменении размера
        loadGoods();
    }

    // Начальная загрузка товаров
    loadGoods();
</script>

</body>
</html>
